---
title: "Enquête Data Publica, édition 2023"
subtitle: "Tri croisé"
date: "Dernière modification le `r format(Sys.time(), '%d %B %Y')`"
output:
    rmarkdown::html_document:
      #number_sections: true
      theme: paper
      toc: true
      toc_depth: 2
      collapsed: true
      smooth_scroll: true
      css: styles.css
      includes:
        in_header: header.html
        after_body: footer.html
---

```{r setup, include=FALSE}
# Paramètres généraux
knitr::opts_chunk$set(
	eval = TRUE,
	echo = FALSE,
	fig.align = "center",
	fig.show = "hold",
	message = FALSE,
	warning = FALSE,
	collapse = TRUE,
	out.width = "100%",
	results = "asis"
)
```

```{r logo}
# Logo Datactivist haut de page
htmltools::img(src = "https://nextcloud.datactivist.coop/s/ReT2njwQenxiFtX/preview", 
               alt = 'logo', 
               style = 'position:absolute; top:0; left:-0.5; padding-top:-2px; width:350px;') #padding=taille des espaces autour
```

# Import des données


```{r données}
# Import de données
library(tidyverse)
data <- read_csv("../Data/results-survey396597.csv") |> select(1:220)
CT_enrichies <- read_csv("../Data/interim_data.csv")

# Jointure questionnaire + type de structure récupéré en pre-processing
data <- data |> 
    left_join(CT_enrichies |> select(-2), by = "ID de la réponse") |> 
    mutate(Catégorie = case_when(Catégorie == "Commune" ~ "Une commune",
                                 Catégorie == "Metropole" ~ "Une métropole",
                                 Catégorie == "Departement" ~ "Un département",
                                 Catégorie == "Region" ~ "Une région",
                                 Catégorie == "EPCI" ~ "Un EPCI (hors métropole)"),
           Catégorie2 = case_when(Catégorie == "Une commune" & `Population totale` < 3500 ~ "Communes de moins de 3 500 hab.",
                               Catégorie == "Une commune" & `Population totale` >= 3500 & `Population totale` < 10000 ~ "Communes de 3 500 à 10 000 hab.",
                               Catégorie == "Une commune" & `Population totale` >= 10000 & `Population totale` < 100000 ~ "Communes de 10 000 à 100 000 hab.",
                               Catégorie == "Une commune" & `Population totale` >= 100000 ~ "Communes de plus de 100 000 hab.",
                               is.na(Catégorie) ~ "Autre",
                               .default = Catégorie),
           Catégorie = case_when(is.na(Catégorie) ~ "Autre", .default = Catégorie))

# Données complètes
data_clean <- data |> 
    filter(!is.na(`Votre structure a-t-elle engagé une réflexion sur les enjeux du numérique responsable ?`))
data_clean_unique <- data_clean |> 
    mutate(nb_na = rowSums(is.na(data_clean))) |> 
    mutate(n = n(), .by = nom) |> 
    group_by(nom) |> slice(which.min(nb_na)) |> ungroup()
data_clean_unique |> 
    rename(structure = Catégorie, structure_pop = Catégorie2) |> 
    select(-c(2:10, SIREN, COG, nb_na, n)) |> 
    rio::export("../Data/process_data.csv")

# Liste des régions
library(tools)
reg <- data_clean_unique |> filter(Catégorie == "Une région") |> 
    mutate(nom = toTitleCase(tolower(nom))) |> distinct(nom) |> t()
```

Les données brutes sont composées de `r nrow(data)` réponses (complètes comme incomplètes) et `r ncol(data)` variables. Elles sont enrichies par le type de territoire et la population extraits des [données OFGL](https://data.ofgl.fr/explore/?exclude.theme=INTERNE&sort=title) en plusieurs étapes :

- retrait des accents, chiffres et caractères spéciaux des noms de structure et mise en majuscule ;
- jointure avec les données OFGL par le nom de structure (lui aussi sans caractères spéciaux etc.) ;
- complétion manuelle du type de structure et de la population pour les structures non enrichies par les données OFGL ; 
- vérification des jointures multiples lorsque plusieurs CT ont un même nom, choix de la bonne collectivité via les informations renseignées dans le questionnaire.

Sont considérées comme complètes toutes les réponses remplies jusqu'à la question *Votre structure a-t-elle engagé une réflexion sur les enjeux du numérique responsable ?*, soit `r nrow(data_clean_unique)` observations en retirant les doublons. Les **types de structure** ayant une réponse complète sont les suivants : 

- `r data_clean_unique |> filter(Catégorie == "Une région") |> nrow()` régions ;
- `r data_clean_unique |> filter(Catégorie == "Un département") |> nrow()` départements ;
- `r data_clean_unique |> filter(Catégorie == "Une commune") |> nrow()` communes ;
    - `r data_clean_unique |> filter(Catégorie2 == "Communes de moins de 3 500 hab.") |> nrow()` communes de moins de 3 500 habitants ;
    - `r data_clean_unique |> filter(Catégorie2 == "Communes de 3 500 à 10 000 hab.") |> nrow()` communes de 3 500 à 10 000 habitants ;
    - `r data_clean_unique |> filter(Catégorie2 == "Communes de 10 000 à 100 000 hab.") |> nrow()` communes de 10 000 à 100 000 habitants ;Afin de respecter le RGPD, avez-vous modifié des
  processus de gestion des données au sein de l'organisation ?
    - `r data_clean_unique |> filter(Catégorie2 == "Communes de plus de 100 000 hab.") |> nrow()` communes de plus de 100 000 habitants ;
- `r data_clean_unique |> filter(Catégorie == "Un EPCI (hors métropole)") |> nrow()` EPCI (hors métropoles) ;
- `r data_clean_unique |> filter(Catégorie == "Une métropole") |> nrow()` métropoles ;
- `r data_clean_unique |> filter(Catégorie == "Autre") |> nrow()` structures '*Autre*', c'est-à-dire n'entrant pas dans les catégories précédentes.

Les régions ayant répondu sont les suivantes : ***`r reg`***.

Les ***réponses*** complètes, enrichies du type de structure, nettoyées des doublons et anonymisées sont consultables sur ce lien : [https://github.com/datactivist/enquete_data_publica/blob/main/Data/process_data.csv](https://github.com/datactivist/enquete_data_publica/blob/main/Data/process_data.csv).

# Tri croisé

Les questions impliquant des **réponses textuelles** ne sont pas présentées dans le tri croisé, il s'agit des questions suivantes : 

- Quelles sont les grandes lignes de cette politique de souveraineté publique sur les données ?
- Si domaine autre, pouvez-vous préciser ?
- Avez-vous identifié d’autres priorités justifiant une utilisation plus importante de données ?
- Quelle forme prend cette participation d’acteurs tiers ?
- Pouvez-vous nous en dire davantage ?
- Quels sont les autres métiers impliqués ?
- Si autres, précisez :
- Pouvez-vous préciser ?
- Pouvez-vous nous décrire ces projets ou expérimentations ?
- Pouvez-vous nous en dire plus sur cette cyberattaque ?

Toutes les questions appelant à **déposer des fichiers** ne sont pas non plus présentées dans le tri croisé. 

Les **pourcentages** présentés dans les statistiques correspondent au pourcentage de répondants pour chaque question, par type de structure.

---

Comme dernière étape avant d'être analysées, les données de l'échantillon ont été ***redressées*** pour les rendre cohérentes aux proportions des collectivités territoriales à l'échelle nationale. Les étapes ci-dessous ont été suivies : 

- récupération du nombre de collectivités par type de structure à partir des chiffres 2023 de la page [*'Collectivités-locales.gouv.fr'*](https://www.collectivites-locales.gouv.fr/collectivites-locales-chiffres-2023), calcul des proportions de chaque type de structure sur le nombre total de collectivités  ;
- calcul des mêmes proportions sur notre échantillon ; 
- calcul des poids à attribuer à chaque type de collectivité pour redresser l'échantillon, tels que poids = proportion nationale / proportion dans l'échantillon ; 
- calcul de la somme des poids par réponse ;
- calcul d'une moyenne pondérée à partir des poids obtenus en étape précédente divisés par la somme totale des poids.

Les statistiques de chaque question comporteront donc 2 lignes ***Total*** ; 

- l'une avec le total de l'échantillon, indiquant entre parenthèses le nombre de réponses reçues pour cette question ; 
- l'autre avec le total pondéré pour correspondre aux proportions nationales.


```{r}
prop_nationales <- data.frame(Structure = c("Une commune",
                                            "Une région",
                                            "Un département",
                                            "Un EPCI (hors métropole)",
                                            "Une métropole",
                                            "Communes de 3 500 à 10 000 hab.",
                                            "Communes de 10 000 à 100 000 hab.",
                                            "Communes de plus de 100 000 hab."),
                              Nombre_nat = c(34945,
                                         18,
                                         101,
                                         1233,
                                         21,
                                         2160,
                                         981,
                                         42)) |> 
    mutate(percent_nat = Nombre_nat / 36318 * 100)
prop_echantillon <- data.frame(Structure = c("Une commune",
                                            "Une région",
                                            "Un département",
                                            "Un EPCI (hors métropole)",
                                            "Une métropole",
                                            "Communes de 3 500 à 10 000 hab.",
                                            "Communes de 10 000 à 100 000 hab.",
                                            "Communes de plus de 100 000 hab."),
                              Nombre_ech = c(data_clean_unique |> filter(Catégorie == "Une commune") |> nrow(),
                                         data_clean_unique |> filter(Catégorie2 == "Une région") |> nrow(),
                                         data_clean_unique |> filter(Catégorie2 == "Un département") |> nrow(),
                                         data_clean_unique |> filter(Catégorie2 == "Un EPCI (hors métropole)") |> nrow(),
                                         data_clean_unique |> filter(Catégorie2 == "Une métropole") |> nrow(),
                                         data_clean_unique |> filter(Catégorie2 == "Communes de 3 500 à 10 000 hab.") |> nrow(),
                                         data_clean_unique |> filter(Catégorie2 == "Communes de 10 000 à 100 000 hab.") |> nrow(),
                                         data_clean_unique |> filter(Catégorie2 == "Communes de plus de 100 000 hab.") |> nrow())) |> 
    mutate(percent_ech = Nombre_ech / nrow(data_clean_unique) * 100)
prop_all <- prop_nationales |> 
    left_join(prop_echantillon, by = "Structure") |> 
    mutate(poids = percent_nat / percent_ech)
```


## Droit des données publiques

### Commençons par la protection de la vie privée. Considérez-vous que votre structure est en conformité avec le RGPD ?

```{r qs1}
# Stats individuelles
stat_qs_simple <- function(n_col, nom_col){
    # Structures détaillées
   cat2 <- data_clean_unique |> 
        select(n_col, Catégorie2) |> 
        summarise(n = n(), .by = c(Catégorie2, 1)) |> #na.omit() |>  
        pivot_wider(names_from = 2, values_from = 3) |>
        janitor::adorn_totals("row") |>
        pivot_longer(cols = -Catégorie2, names_to = "cat", values_to = "n")
   nb_na <- 191 - (cat2 |> filter(Catégorie2 == "Total" & cat != "NA") |> mutate(Total = sum(n)) |> distinct(Total))
   cat2 <- cat2 |> 
        mutate(Catégorie2 = case_when(Catégorie2 == "Total" ~ paste0("Total (", sum(n[Catégorie2 == "Total"]) - nb_na, " réponses)"), .default = Catégorie2)) |> 
        mutate_all(replace_na, replace = 0) |>
        mutate(percent = paste0(round(n / sum(n) *100, 0), "%"), .by = Catégorie2) |> 
        select(-n) |> pivot_wider(names_from = 2, values_from = 3)
     # Structure 'commune' seulement
    cat1 <- data_clean_unique |> 
        select(n_col, Catégorie) |> 
        filter(Catégorie == "Une commune") |> 
        summarise(n = n(), .by = c(Catégorie, 1)) |> #na.omit() |>  
        mutate(percent = paste0(round(n / sum(n) *100, 0), "%"), .by = Catégorie) |> 
        select(-n) |> pivot_wider(names_from = 2, values_from = 3)
    nb_col <- ncol(cat2)
     # Moyenne pondérée
    moy_pond <- data_clean_unique |> 
        select(n_col, Catégorie2) |> 
        summarise(n = n(), .by = c(Catégorie2, 1)) |> 
        pivot_wider(names_from = 2, values_from = 3) |>
        pivot_longer(cols = -Catégorie2, names_to = "cat", values_to = "n") |> 
        mutate_all(replace_na, replace = 0) |>
        left_join(prop_all |> select(1, 6), by = c("Catégorie2" = "Structure")) |> 
        mutate(poids = case_when(is.na(poids) ~ 0, .default = poids),
               percent_normal = paste0(round(n / sum(n) *100, 0), "%"),
               .by = Catégorie2) |> 
        mutate(poids_CT = n * poids) |> 
        group_by(cat) |> 
        summarise(p=sum(poids_CT)) |> ungroup() |> 
        mutate(`Total pondéré`= paste0(round(p/sum(p)*100, 0), "%")) |> 
        select(-p) |> 
        pivot_wider(names_from = 1, values_from = 2) |> 
        mutate(Catégorie = "Total pondéré", .before = 1)
     # Jointure, statistiques finales
    stat_indiv <- list(cat1, cat2 |> rename(Catégorie = Catégorie2)) |> 
        bind_rows() |> ungroup() |> 
        rbind(moy_pond) |> 
        mutate_all(replace_na, replace = "0%") |>  
        mutate(index = case_match(Catégorie, 
                                  "Total" ~ 1.5,
                                  "Une commune" ~ 2,
                                  "Communes de moins de 3 500 hab." ~ 3,
                                  "Communes de 3 500 à 10 000 hab." ~ 4,
                                  "Communes de 10 000 à 100 000 hab." ~ 5,
                                  "Communes de plus de 100 000 hab." ~ 6,
                                  "Une métropole" ~ 7,
                                  "Un EPCI (hors métropole)" ~ 8,
                                  "Un département" ~ 9,
                                  "Une région" ~ 10,
                                  "Autre" ~ 11, 
                                  .default = 1)) |> 
        arrange(index) |> select(-index) |> ungroup()
    # Création colonne 'Sans réponse' si n'existe pas déjà
    stat_indiv <- stat_indiv |> ungroup() |> 
        select(1, order(colnames(stat_indiv))) |> 
        rowwise() |> 
        mutate(`NA` = ifelse("NA" %in% names(stat_indiv), `NA`, "0%")) |> 
        mutate(`Sans réponse` = `NA`, .after = ncol(stat_indiv)) |> 
        select(-`NA`) |> 
        rename({{ nom_col }} := 1)
    # On affiche la table finale
    knitr::kable(stat_indiv, format = "html") |> 
      kableExtra::kable_styling(bootstrap_options = c("striped", "hover"))
}
stat_qs_simple(13, "Commençons par la protection de la vie privée. Considérez-vous que votre structure est en conformité avec le RGPD ?")
```

### Avez-vous nommé un(e) Délégué(e) à la Protection des Données (DPO) ?

```{r}
stat_qs_simple(14, "Avez-vous nommé un(e) Délégué(e) à la Protection desAfin de respecter le RGPD, avez-vous modifié des
  processus de gestion des données au sein de l'organisation ? Données (DPO) ?")
```


### Afin de respecter le RGPD, avez-vous modifié des processus de gestion des données au sein de l'organisation ?

```{r}
stat_qs_simple(15, "Afin de respecter le RGPD, avez-vous modifié des processus de gestion des données au sein de l'organisation ?")
```


### De manière générale, avez-vous mis en place des clauses juridiques sur la gestion des données dans les contrats de délégation et dans les marchés publics ?

```{r}
stat_qs_simple(18, "De manière générale, avez-vous mis en place des clauses juridiques sur la gestion des données dans les contrats de délégation et dans les marchés publics ?")
```



### Quels sont le ou les domaines concernés par ces clauses ?

```{r}
ref_nb_structures <- rbind(data_clean_unique |> summarise(n_total = n(), .by = Catégorie2),
                  data_clean_unique |> filter(Catégorie == "Une commune") |> summarise(n_total = n(), .by = Catégorie) |> rename(Catégorie2 = 1)) |>
    add_row(Catégorie2 = "Total", n_total = nrow(data_clean_unique))
nb_commune <- (ref_nb_structures |> filter(Catégorie2 == "Une commune") |> select(n_total))$n_total

stat_qs_multiple <- function(min_col, max_col, nom_col){
    ref_question <- data_clean_unique |> 
        select(min_col:max_col, 226) |> 
        group_by(Catégorie2) |> 
        filter(across(where(is.character), ~. != "N/A")) |> 
        ungroup() |> 
        summarise(n_total = n(), .by = Catégorie2)
    total <- sum(ref_question$n_total)
    sans_rep <- data_clean_unique |> 
        select(min_col:max_col, 226) |> 
        group_by(Catégorie2) |> 
        summarise_all(funs(sum(. == "N/A"))) |> 
        janitor::adorn_totals("row") |>
        select(Catégorie2, 2) |> 
        rename(`Sans réponse` = 2) |> 
        mutate(n2 = case_when(grepl("Communes", Catégorie2) == TRUE ~ `Sans réponse`, .default = NA_real_))
    sans_rep <- sans_rep |> 
        add_row(Catégorie2 = "Une commune", `Sans réponse` = sum(sans_rep$n2, na.rm = TRUE)) |> 
        select(-n2)
    cat1 <- data_clean_unique |> 
        select(min_col:max_col, 226) |> 
        group_by(Catégorie2) |> 
        summarise_all(funs(sum(. == "Oui"))) |> 
        janitor::adorn_totals("row") |>
        left_join(sans_rep, by = "Catégorie2") |> 
        pivot_longer(cols = -Catégorie2, names_to = "cat", values_to = "n") |> 
        left_join(ref_nb_structures, by = "Catégorie2") |> 
        mutate(cat = str_extract(cat, "(?<=\\[).*"),
               cat = str_replace_all(cat, "\\]", ""),
               percent = paste0(round(n / n_total *100, 0), "%"), .by = Catégorie2) |> 
        select(-c(n, n_total)) |> pivot_wider(names_from = 2, values_from = 3)
    cat2 <- data_clean_unique |> 
        filter(Catégorie == "Une commune") |> 
        select(min_col:max_col, 225) |> 
        group_by(Catégorie) |> 
        summarise_all(funs(sum(. == "Oui"))) |> 
        left_join(sans_rep, by = c("Catégorie" = "Catégorie2")) |> 
        pivot_longer(cols = -Catégorie, names_to = "cat", values_to = "n") |> 
        mutate(cat = str_extract(cat, "(?<=\\[).*"),
               cat = str_replace_all(cat, "\\]", ""),
               percent = paste0(round(n / nb_commune *100, 0), "%")) |> 
        select(-n) |> pivot_wider(names_from = 2, values_from = 3)
     # Moyenne pondérée
    moy_pond <- data_clean_unique |> 
        select(min_col:max_col, 226) |> 
        group_by(Catégorie2) |> 
        summarise_all(funs(sum(. == "Oui"))) |> 
        pivot_longer(cols = -Catégorie2, names_to = "cat", values_to = "n") |> 
        mutate(cat = str_extract(cat, "(?<=\\[).*"),
               cat = str_replace_all(cat, "\\]", "")) |> 
        mutate_all(replace_na, replace = 0) |>
        left_join(prop_all |> select(1, 6), by = c("Catégorie2" = "Structure")) |> 
        mutate(poids = case_when(is.na(poids) ~ 0, .default = poids),
               percent_normal = paste0(round(n / sum(n) *100, 0), "%"),
               .by = Catégorie2) |> 
        mutate(poids_CT = n * poids) |> 
        group_by(cat) |> 
        summarise(p=sum(poids_CT)) |> ungroup() |> 
        mutate(`Total pondéré`= paste0(round(p/sum(p)*100, 0), "%")) |> 
        select(-p) |> 
        pivot_wider(names_from = 1, values_from = 2) |> 
        mutate(Catégorie = "Total pondéré", .before = 1) |> 
        mutate(`NA` = NA_real_)
    # All together
    stat_indiv <- list(cat2, cat1 |> rename(Catégorie = Catégorie2)) |> 
        bind_rows() |> ungroup() |> 
        rbind(moy_pond) |> 
        mutate_all(replace_na, replace = "0%") |>  
        mutate(index = case_match(Catégorie, 
                                  "Total pondéré" ~ 1.5,
                                  "Une commune" ~ 2,
                                  "Communes de moins de 3 500 hab." ~ 3,
                                  "Communes de 3 500 à 10 000 hab." ~ 4,
                                  "Communes de 10 000 à 100 000 hab." ~ 5,
                                  "Communes de plus de 100 000 hab." ~ 6,
                                  "Une métropole" ~ 7,
                                  "Un EPCI (hors métropole)" ~ 8,
                                  "Un département" ~ 9,
                                  "Une région" ~ 10,
                                  "Autre" ~ 11, 
                                  .default = 1)) |> 
        arrange(index) |> select(-index) |> 
        mutate_all(function(x) gsub("NA%", "0%", x)) |> ungroup() |> 
        mutate(Catégorie = case_when(Catégorie == "Total" ~ paste0("Total (", total, " réponses)"), 
                                      .default = Catégorie)) 
        # Création colonne 'Sans réponse' si n'existe pas déjà
    stat_indiv <- stat_indiv |> ungroup() |> 
        select(1, order(colnames(stat_indiv))) |> 
        mutate(`Sans réponse` = `NA`, .after = ncol(stat_indiv)) |> 
        select(-`NA`) |> 
        rename({{ nom_col }} := 1)
    
    knitr::kable(stat_indiv, format = "html") |> 
      kableExtra::kable_styling(bootstrap_options = c("striped", "hover"))
}
stat_qs_multiple(19, 22, "Quels sont le ou les domaines concernés par ces clauses ?")
```


### La question de la souveraineté numérique préoccupe de plus en plus d'acteurs publics : choix des éditeurs de logiciels, hébergement des données en Europe ou en France, maîtrise des données par la collectivité... Votre organisation a-t-elle défini une politique en matière de souveraineté publique sur les données ?

```{r}
stat_qs_simple(16, "La question de la souveraineté numérique préoccupe de plus en plus d'acteurs publics : choix des éditeurs de logiciels, hébergement des données en Europe ou en France, maîtrise des données par la collectivité... Votre organisation a-t-elle défini une politique en matière de souveraineté publique sur les données ?")
```





## Les objectifs et les priorités pour l'utilisation des données

### Pour chacun de ces domaines, pouvez-vous préciser si votre structure a engagé ces deux dernières années un ou plusieurs projets ou expérimentations en matière d'utilisation des données, ou prévoit d’en engager au cours des douze prochains mois ?

+ **Aménagement du territoire**

```{r}
stat_qs_simple(26, "Pour chacun de ces domaines, pouvez-vous préciser si votre structure a engagé ces deux dernières années un ou plusieurs projets ou expérimentations en matière d'utilisation des données, ou prévoit d’en engager au cours des douze prochains mois ? [Aménagement du territoire]")
```

+ **Mobilité**

```{r}
stat_qs_simple(27, "Pour chacun de ces domaines, pouvez-vous préciser si votre structure a engagé ces deux dernières années un ou plusieurs projets ou expérimentations en matière d'utilisation des données, ou prévoit d’en engager au cours des douze prochains mois ? [Mobilité]")
```

+ **Administration**

```{r}
stat_qs_simple(28, "Pour chacun de ces domaines, pouvez-vous préciser si votre structure a engagé ces deux dernières années un ou plusieurs projets ou expérimentations en matière d'utilisation des données, ou prévoit d’en engager au cours des douze prochains mois ? [Administration]")
```

+ **Développement économique**

```{r}
stat_qs_simple(29, "Pour chacun de ces domaines, pouvez-vous préciser si votre structure a engagé ces deux dernières années un ou plusieurs projets ou expérimentations en matière d'utilisation des données, ou prévoit d’en engager au cours des douze prochains mois ? [Développement économique]")
```

+ **Gestion de l’espace public**

```{r}
stat_qs_simple(30, "Pour chacun de ces domaines, pouvez-vous préciser si votre structure a engagé ces deux dernières années un ou plusieurs projets ou expérimentations en matière d'utilisation des données, ou prévoit d’en engager au cours des douze prochains mois ? [Gestion de l’espace public]")
```

+ **Sécurité**

```{r}
stat_qs_simple(31, "Pour chacun de ces domaines, pouvez-vous préciser si votre structure a engagé ces deux dernières années un ou plusieurs projets ou expérimentations en matière d'utilisation des données, ou prévoit d’en engager au cours des douze prochains mois ? [Sécurité]")
```

+ **Patrimoine**

```{r}
stat_qs_simple(32, "Pour chacun de ces domaines, pouvez-vous préciser si votre structure a engagé ces deux dernières années un ou plusieurs projets ou expérimentations en matière d'utilisation des données, ou prévoit d’en engager au cours des douze prochains mois ? [Patrimoine]")
```

+ **Energie et éclairage**

```{r}
stat_qs_simple(33, "Pour chacun de ces domaines, pouvez-vous préciser si votre structure a engagé ces deux dernières années un ou plusieurs projets ou expérimentations en matière d'utilisation des données, ou prévoit d’en engager au cours des douze prochains mois ? [Energie et éclairage]")
```

+ **Déchets**

```{r}
stat_qs_simple(38, "Pour chacun de ces domaines, pouvez-vous préciser si votre structure a engagé ces deux dernières années un ou plusieurs projets ou expérimentations en matière d'utilisation des données, ou prévoit d’en engager au cours des douze prochains mois ? [Déchets]")
```

+ **Tourisme**

```{r}
stat_qs_simple(34, "Pour chacun de ces domaines, pouvez-vous préciser si votre structure a engagé ces deux dernières années un ou plusieurs projets ou expérimentations en matière d'utilisation des données, ou prévoit d’en engager au cours des douze prochains mois ? [Tourisme]")
```

+ **Citoyenneté**

```{r}
stat_qs_simple(35, "Pour chacun de ces domaines, pouvez-vous préciser si votre structure a engagé ces deux dernières années un ou plusieurs projets ou expérimentations en matière d'utilisation des données, ou prévoit d’en engager au cours des douze prochains mois ? [Citoyenneté]")
```

+ **Environnement**

```{r}
stat_qs_simple(36, "Pour chacun de ces domaines, pouvez-vous préciser si votre structure a engagé ces deux dernières années un ou plusieurs projets ou expérimentations en matière d'utilisation des données, ou prévoit d’en engager au cours des douze prochains mois ? [Environnement]")
```

+ **Autre**

```{r}
stat_qs_simple(37, "Pour chacun de ces domaines, pouvez-vous préciser si votre structure a engagé ces deux dernières années un ou plusieurs projets ou expérimentations en matière d'utilisation des données, ou prévoit d’en engager au cours des douze prochains mois ? [Autre]")
```


### Quelles sont, selon vous, les priorités qui justifient (ou justifieraient) une utilisation plus importante des données au sein de votre organisation ? Classez du plus important au moins important (de haut en bas)


+ **Classement 1**

```{r}
stat_qs_simple(40, "Quelles sont, selon vous, les priorités qui justifient (ou justifieraient) une utilisation plus importante des données au sein de votre organisation ? Classez du plus important au moins important (de haut en bas)  [Classement 1]")
```


+ **Classement 2**

```{r}
stat_qs_simple(41, "Quelles sont, selon vous, les priorités qui justifient (ou justifieraient) une utilisation plus importante des données au sein de votre organisation ? Classez du plus important au moins important (de haut en bas)  [Classement 2]")
```


+ **Classement 3**

```{r}
stat_qs_simple(42, "Quelles sont, selon vous, les priorités qui justifient (ou justifieraient) une utilisation plus importante des données au sein de votre organisation ? Classez du plus important au moins important (de haut en bas)  [Classement 3]")
```


+ **Classement 4**

```{r}
stat_qs_simple(43, "Quelles sont, selon vous, les priorités qui justifient (ou justifieraient) une utilisation plus importante des données au sein de votre organisation ? Classez du plus important au moins important (de haut en bas)  [Classement 4]")
```


+ **Classement 5**

```{r}
stat_qs_simple(44, "Quelles sont, selon vous, les priorités qui justifient (ou justifieraient) une utilisation plus importante des données au sein de votre organisation ? Classez du plus important au moins important (de haut en bas)  [Classement 5]")
```




### Selon-vous, la maîtrise de la donnée constitue-t-elle un outil pertinent pour répondre aux enjeux environnementaux de votre territoire ?

```{r}
stat_qs_simple(46, "Selon-vous, la maîtrise de la donnée constitue-t-elle un outil pertinent pour répondre aux enjeux environnementaux de votre territoire ?")
```


## La gouvernance des données

### Votre structure a-t-elle défini des règles de gouvernance de la donnée (internes ou externes) ?

```{r}
stat_qs_simple(49, "Votre structure a-t-elle défini des règles de gouvernance de la donnée (internes ou externes) ?")
```


### Pouvez-vous préciser quelles sont ces règles ?

```{r}
stat_qs_multiple(50, 53, "Pouvez-vous préciser quelles sont ces règles ?")
```


### Votre structure a-t-elle adopté une charte éthique de la donnée ?

```{r}
stat_qs_simple(55, "Votre structure a-t-elle adopté une charte éthique de la donnée ?")
```


### La structure a-t-elle associé des acteurs externes à la définition de ces règles de gouvernance ?

```{r}
stat_qs_multiple(58, 63, "La structure a-t-elle associé des acteurs externes à la définition de ces règles de gouvernance ?")
```



### Votre structure a-t-elle mis en place des systèmes d’échanges et de partage de données avec des acteurs privés du territoire, ou prévoit-elle d’en mettre en place dans les douze prochains mois ?

+ **Des plateformes générales de partage et d'accès aux données locales (ex : plateforme OpenDataSoft avec accès privés, plateforme Dawex…)**

```{r}
stat_qs_simple(66, "Votre structure a-t-elle mis en place des systèmes d’échanges et de partage de données avec des acteurs privés du territoire, ou prévoit-elle d’en mettre en place dans les douze prochains mois ?    [Des plateformes générales de partage et d'accès aux données locales (ex : plateforme OpenDataSoft avec accès privés, plateforme Dawex…)]")
```

+ **Des  communications ponctuelles de données avec des partenaires/prestataires (par exemple communication de données foncières dans le cadre de la réalisation d’une étude ou d’une AMO)**

```{r}
stat_qs_simple(67, "Votre structure a-t-elle mis en place des systèmes d’échanges et de partage de données avec des acteurs privés du territoire, ou prévoit-elle d’en mettre en place dans les douze prochains mois ?    [Des  communications ponctuelles de données avec des partenaires/prestataires (par exemple communication de données foncières dans le cadre de la réalisation d’une étude ou d’une AMO) ]")
```

+ **Des échanges de cas d’usage/bonnes pratiques concernant la gestion et la valorisation des données ou algorithmes**

```{r}
stat_qs_simple(68, "Votre structure a-t-elle mis en place des systèmes d’échanges et de partage de données avec des acteurs privés du territoire, ou prévoit-elle d’en mettre en place dans les douze prochains mois ?    [Des échanges de cas d’usage/bonnes pratiques concernant la gestion et la valorisation des données ou algorithmes ]")
```


## Le management de la donnée


### Comment estimez-vous le niveau d’acculturation de votre structure aux enjeux des données ?

```{r}
stat_qs_simple(70, "Comment estimez-vous le niveau d’acculturation de votre structure aux enjeux des données ?")
```


### Quels sont, selon vous, les principaux obstacles à la diffusion d’outils innovants en matière de gestion des données ?

```{r}
stat_qs_multiple(71, 75, "Quels sont, selon vous, les principaux obstacles à la diffusion d’outils innovants en matière de gestion des données ?")
```


### En matière de formation sur la gestion des données, quels sont, selon vous, les besoins prioritaires pour votre structure ?

```{r}
stat_qs_multiple(77, 82, "En matière de formation sur la gestion des données, quels sont, selon vous, les besoins prioritaires pour votre structure ?")
```


### Pour chacune des directions suivantes, pouvez-vous nous dire si leur implication en matière de gestion des données est


+ **Direction générale**

```{r}
stat_qs_simple(84, "Pour chacune des directions suivantes, pouvez-vous nous dire si leur implication en matière de gestion des données est : [Direction générale]")
```

+ **Direction Informatique**

```{r}
stat_qs_simple(85, "Pour chacune des directions suivantes, pouvez-vous nous dire si leur implication en matière de gestion des données est : [Direction Informatique]")
```


+ **Service d’information géographique (SIG)]**

```{r}
stat_qs_simple(86, "Pour chacune des directions suivantes, pouvez-vous nous dire si leur implication en matière de gestion des données est : [Service d’information géographique (SIG)")
```


+ **Archives**

```{r}
stat_qs_simple(87, "Pour chacune des directions suivantes, pouvez-vous nous dire si leur implication en matière de gestion des données est : [Archives]")
```


+ **Communication**

```{r}
stat_qs_simple(88, "Pour chacune des directions suivantes, pouvez-vous nous dire si leur implication en matière de gestion des données est : [Communication]")
```


+ **Services techniques**

```{r}
stat_qs_simple(89, "Pour chacune des directions suivantes, pouvez-vous nous dire si leur implication en matière de gestion des données est : [Services techniques]")
```


+ **Ressources humaines**

```{r}
stat_qs_simple(90, "Pour chacune des directions suivantes, pouvez-vous nous dire si leur implication en matière de gestion des données est : [Ressources humaines]")
```



### Dans votre organisation, ces fonctions consacrées à la donnée existent-elles ou seront-elles créées dans les douze prochains mois ?

+ **Comité data**

```{r}
stat_qs_simple(93, "Dans votre organisation, ces fonctions consacrées à la donnée existent-elles ou seront-elles créées dans les douze prochains mois ?  [Comité data]")
```

+ **Réseau de référent(e)s data**

```{r}
stat_qs_simple(94, "Dans votre organisation, ces fonctions consacrées à la donnée existent-elles ou seront-elles créées dans les douze prochains mois ?  [Réseau de référent(e)s data]")
```

+ **Direction de la donnée**

```{r}
stat_qs_simple(95, "Dans votre organisation, ces fonctions consacrées à la donnée existent-elles ou seront-elles créées dans les douze prochains mois ?  [Direction de la donnée]")
```

+ **Chief data officer / administrateur général des données**

```{r}
stat_qs_simple(96, "Dans votre organisation, ces fonctions consacrées à la donnée existent-elles ou seront-elles créées dans les douze prochains mois ?  [Chief data officer / administrateur général des données]")
```



### Avec lesquels de ces partenaires potentiels collaborez-vous, ou prévoyez-vous de le faire, au sujet des données ?

+ **Un Assistant à la maîtrise d’ouvrage (AMO)**

```{r}
stat_qs_simple(99, "Avec lesquels de ces partenaires potentiels collaborez-vous, ou prévoyez-vous de le faire, au sujet des données ?  [Un Assistant à la maîtrise d’ouvrage (AMO) ]")
```

+ **Un prestataire informatique**

```{r}
stat_qs_simple(100, "Avec lesquels de ces partenaires potentiels collaborez-vous, ou prévoyez-vous de le faire, au sujet des données ?  [Un prestataire informatique]")
```

+ **Un délégataire de service public**

```{r}
stat_qs_simple(101, "Avec lesquels de ces partenaires potentiels collaborez-vous, ou prévoyez-vous de le faire, au sujet des données ?  [Un délégataire de service public]")
```

+ **Un opérateur public de service numérique (OPSN)**

```{r}
stat_qs_simple(102, "Avec lesquels de ces partenaires potentiels collaborez-vous, ou prévoyez-vous de le faire, au sujet des données ?  [Un opérateur public de service numérique (OPSN)]")
```

+ **Une plateforme régionale d’information géographique**

```{r}
stat_qs_simple(103, "Avec lesquels de ces partenaires potentiels collaborez-vous, ou prévoyez-vous de le faire, au sujet des données ?  [Une plateforme régionale d’information géographique]")
```

+ **Un opérateur numérique**

```{r}
stat_qs_simple(104, "Avec lesquels de ces partenaires potentiels collaborez-vous, ou prévoyez-vous de le faire, au sujet des données ?  [Un opérateur numérique]")
```

+ **Une collectivité territoriale plus grande (ex : EPCI, métropole, région)**

```{r}
stat_qs_simple(105, "Avec lesquels de ces partenaires potentiels collaborez-vous, ou prévoyez-vous de le faire, au sujet des données ?  [Une collectivité territoriale plus grande (ex : EPCI, métropole, région)]")
```

+ **Une association de collectivités (ex : OpenData France, FNCCR…)**

```{r}
stat_qs_simple(106, "Avec lesquels de ces partenaires potentiels collaborez-vous, ou prévoyez-vous de le faire, au sujet des données ?  [Une association de collectivités (ex : OpenData France, FNCCR…)]")
```

+ **Un service de l’Etat (ex : ANCT, SGAR…)**

```{r}
stat_qs_simple(107, "Avec lesquels de ces partenaires potentiels collaborez-vous, ou prévoyez-vous de le faire, au sujet des données ?  [Un service de l’Etat (ex : ANCT, SGAR…)]")
```

+ **Autres**

```{r}
stat_qs_simple(108, "Avec lesquels de ces partenaires potentiels collaborez-vous, ou prévoyez-vous de le faire, au sujet des données ?  [Autres]")
```



## L’ouverture et la transparence

### Pensez-vous que les services de votre structure sont bien informés des obligations d’open data applicables depuis 2018 à toutes les administrations publiques de plus de 50 ETP, et notamment les collectivités de plus de 3 500 habitants ?

```{r}
stat_qs_simple(111, "Pensez-vous que les services de votre structure sont bien informés des obligations d’open data applicables depuis 2018 à toutes les administrations publiques de plus de 50 ETP, et notamment les collectivités de plus de 3 500 habitants ?")
```


### Depuis le 1er juillet 2020, les collectivités sont également soumises à une obligation de « transparence algorithmique ». Pensez-vous que les services de votre structure sont bien informés de cette obligation légale ?

```{r}
stat_qs_simple(112, "Depuis le 1er juillet 2020, les collectivités sont également soumises à une obligation de « transparence algorithmique ». Pensez-vous que les services de votre structure sont bien informés de cette obligation légale ?")
```


### Votre structure a-t-elle conduit des actions pour mettre en œuvre les obligations de transparence algorithmique ?

```{r}
stat_qs_simple(113, "Votre structure a-t-elle conduit des actions pour mettre en œuvre les obligations de transparence algorithmique ?")
```



## L'intelligence artificielle

### Votre structure a-t-elle déjà mis en place des projets ou expérimentations ayant recours à l’intelligence artificielle ?

```{r}
stat_qs_simple(115, "Votre structure a-t-elle déjà mis en place des projets ou expérimentations ayant recours à l’intelligence artificielle ?")
```


### À quel type de technique d’intelligence artificielle votre (vos) projet (s) ou expérimentation(s) recoure(nt)-elle(s) ?

```{r}
stat_qs_multiple(116, 121, "À quel type de technique d’intelligence artificielle votre (vos) projet (s) ou expérimentation(s) recoure(nt)-elle(s) ?")
```


### Quel(s) est (sont) le(s) domaine(s) concerné(s) ?

```{r}
stat_qs_multiple(123, 136, "Quel(s) est (sont) le(s) domaine(s) concerné(s) ?")
```



### Envisagez-vous de déployer des projets ou expérimentations recourant à de l’IA dans les 12 prochains mois ?

```{r}
stat_qs_simple(139, "Envisagez-vous de déployer des projets ou expérimentations recourant à de l’IA dans les 12 prochains mois ?")
```


### À quel type de technique d’intelligence artificielle votre (vos) projet(s) ou expérimentation(s) recourera(ont)-elle(s) ?

```{r}
stat_qs_multiple(140, 145, "À quel type de technique d’intelligence artificielle votre (vos) projet(s) ou expérimentation(s) recourera(ont)-elle(s) ?")
```


### Quel(s) sera (seront) le(s) domaine(s) concerné(s) ?

```{r}
stat_qs_multiple(147, 160, "Quel(s) sera (seront) le(s) domaine(s) concerné(s) ?")
```


## Les enjeux techniques de la gestion des données

### Aujourd’hui, les données de votre structure sont majoritairement hébergées

```{r}
stat_qs_simple(162, "Aujourd’hui, les données de votre structure sont majoritairement hébergées")
```


### Votre structure a-t-elle déployé les technologies suivantes, ou prévoit-elle de le faire dans les 12 prochains mois ?


+ **Plateforme de données (ingestion, stockage, traitement, analyse  et visualisation de données)**

```{r}
stat_qs_simple(163, "Votre structure a-t-elle déployé les technologies suivantes, ou prévoit-elle de le faire dans les 12 prochains mois ? [Plateforme de données (ingestion, stockage, traitement, analyse  et visualisation de données)]")
```

+ **Outils de traitement et d'analyse de données**

```{r}
stat_qs_simple(164, "Votre structure a-t-elle déployé les technologies suivantes, ou prévoit-elle de le faire dans les 12 prochains mois ? [Outils de traitement et d'analyse de données]")
```


+ **Lac de données**

```{r}
stat_qs_simple(165, "Votre structure a-t-elle déployé les technologies suivantes, ou prévoit-elle de le faire dans les 12 prochains mois ? [Lac de données]")
```


+ **Capteurs et réseaux IoT**

```{r}
stat_qs_simple(166, "Votre structure a-t-elle déployé les technologies suivantes, ou prévoit-elle de le faire dans les 12 prochains mois ? [Capteurs et réseaux IoT]")
```


+ **Catalogue de données**

```{r}
stat_qs_simple(167, "Votre structure a-t-elle déployé les technologies suivantes, ou prévoit-elle de le faire dans les 12 prochains mois ? [Catalogue de données]")
```


+ **Jumeau numérique**

```{r}
stat_qs_simple(168, "Votre structure a-t-elle déployé les technologies suivantes, ou prévoit-elle de le faire dans les 12 prochains mois ? [Jumeau numérique]")
```


+ **Hyperviseur**

```{r}
stat_qs_simple(169, "Votre structure a-t-elle déployé les technologies suivantes, ou prévoit-elle de le faire dans les 12 prochains mois ? [Hyperviseur]")
```



### Votre structure a-t-elle mis en place des technologies mutualisées, ou prévoit-elle de le faire dans les douze prochains mois, avec les acteurs publics ou associatifs suivants


+ **Une plateforme régionale d’information géographique**

```{r}
stat_qs_simple(170, "Votre structure a-t-elle mis en place des technologies mutualisées, ou prévoit-elle de le faire dans les douze prochains mois, avec les acteurs publics ou associatifs suivants : [Une plateforme régionale d’information géographique]")
```

+ **Un OPSN (opérateur public de services numériques)**

```{r}
stat_qs_simple(171, "Votre structure a-t-elle mis en place des technologies mutualisées, ou prévoit-elle de le faire dans les douze prochains mois, avec les acteurs publics ou associatifs suivants : [Un OPSN (opérateur public de services numériques)]")
```

+ **Une collectivité territoriale plus grande (ex : EPCI, métropole, région…)**

```{r}
stat_qs_simple(172, "Votre structure a-t-elle mis en place des technologies mutualisées, ou prévoit-elle de le faire dans les douze prochains mois, avec les acteurs publics ou associatifs suivants : [Une collectivité territoriale plus grande (ex : EPCI, métropole, région…)]")
```

+ **Une association de collectivités (ex : OpenData France, FNCCR…)**

```{r}
stat_qs_simple(173, "Votre structure a-t-elle mis en place des technologies mutualisées, ou prévoit-elle de le faire dans les douze prochains mois, avec les acteurs publics ou associatifs suivants : [Une association de collectivités (ex : OpenData France, FNCCR…)]")
```


### Certaines structures attachent une importance particulière au caractère « souverain » des outils et des logiciels qu'elles utilisent. Cela peut se traduire par le choix prioritaire de logiciels français ou européens, ou encore par le recours à des solutions dites « open source » (dont le code informatique est libre de droits et géré par des communautés d'utilisateurs).   Pour le choix de ses outils et logiciels, votre structure :

```{r}
stat_qs_simple(174, "Certaines structures attachent une importance particulière au caractère « souverain » des outils et des logiciels qu'elles utilisent. Cela peut se traduire par le choix prioritaire de logiciels français ou européens, ou encore par le recours à des solutions dites « open source » (dont le code informatique est libre de droits et géré par des communautés d'utilisateurs).   Pour le choix de ses outils et logiciels, votre structure :")
```

### Lorsqu'une alternative open source est identifiée :

```{r}
stat_qs_simple(175, "Lorsqu'une alternative open source est identifiée")
```

### Des critères de réversibilité (facilitation de la récupération de ses données) et d’interopérabilité (facilitation de l’échange de données) peuvent également être considérés lorsqu’une organisation fait le choix de ses solutions.   La réversibilité est-elle un critère entrant en compte dans le choix des solutions de votre structure ?

```{r}
stat_qs_simple(176, "Des critères de réversibilité (facilitation de la récupération de ses données) et d’interopérabilité (facilitation de l’échange de données) peuvent également être considérés lorsqu’une organisation fait le choix de ses solutions.   La réversibilité est-elle un critère entrant en compte dans le choix des solutions de votre structure ?")
```


### L’interopérabilité est-elle un critère entrant en compte dans le choix des solutions de votre structure ?

```{r}
stat_qs_simple(177, "L’interopérabilité est-elle un critère entrant en compte dans le choix des solutions de votre structure ?")
```


## La cybersécurité

### Votre structure a-t-elle déjà dû faire face à une cyberattaque importante ?

```{r}
stat_qs_simple(178, "Votre structure a-t-elle déjà dû faire face à une cyberattaque importante ?")
```


### Pensez-vous que votre structure est exposée à des attaques cyber ?

```{r}
stat_qs_simple(180, "Pensez-vous que votre structure est exposée à des attaques cyber ?")
```


### Comment estimez-vous le niveau de prise en compte du risque cyber par votre structure ?

```{r}
stat_qs_simple(181, "Comment estimez-vous le niveau de prise en compte du risque cyber par votre structure ?")
```


### Quels sont, selon vous, les principaux obstacles à la mise en place d’outils de sécurité informatique dans votre structure ?

```{r}
stat_qs_multiple(182, 186, "Quels sont, selon vous, les principaux obstacles à la mise en place d’outils de sécurité informatique dans votre structure ?")
```


### Parmi les mesures suivantes, qui visent à réduire le risque de cybersécurité, est-ce que votre structure a mis en place


+ **Une formation pour les agents et les élus**

```{r}
stat_qs_simple(188, "Parmi les mesures suivantes, qui visent à réduire le risque de cybersécurité, est-ce que votre structure a mis en place : [Une formation pour les agents et les élus]")
```

+ **La désignation d’un responsable de sécurité informatique (RSSI ou autre)**

```{r}
stat_qs_simple(189, "Parmi les mesures suivantes, qui visent à réduire le risque de cybersécurité, est-ce que votre structure a mis en place : [La désignation d’un responsable de sécurité informatique (RSSI ou autre)]")
```

+ **Une stratégie de sécurité informatique**

```{r}
stat_qs_simple(190, "Parmi les mesures suivantes, qui visent à réduire le risque de cybersécurité, est-ce que votre structure a mis en place : [Une stratégie de sécurité informatique]")
```

+ **Un processus de certification (ISO 27001)**

```{r}
stat_qs_simple(191, "Parmi les mesures suivantes, qui visent à réduire le risque de cybersécurité, est-ce que votre structure a mis en place : [Un processus de certification (ISO 27001)]")
```

+ **Une obligation d’hébergement souverain (français ou européen)**

```{r}
stat_qs_simple(192, "Parmi les mesures suivantes, qui visent à réduire le risque de cybersécurité, est-ce que votre structure a mis en place : [Une obligation d’hébergement souverain (français ou européen)]")
```

+ **Des clauses de sécurité dans les contrats informatiques**

```{r}
stat_qs_simple(193, "Parmi les mesures suivantes, qui visent à réduire le risque de cybersécurité, est-ce que votre structure a mis en place : [Des clauses de sécurité dans les contrats informatiques]")
```

+ **Des clauses de sécurité pour les délégations de service public**

```{r}
stat_qs_simple(194, "Parmi les mesures suivantes, qui visent à réduire le risque de cybersécurité, est-ce que votre structure a mis en place : [Des clauses de sécurité pour les délégations de service public]")
```

+ **Une coopération avec l’Agence nationale de la sécurité des systèmes d’information (ANSSI) ou avec un cyber campus régional**

```{r}
stat_qs_simple(195, "Parmi les mesures suivantes, qui visent à réduire le risque de cybersécurité, est-ce que votre structure a mis en place : [Une coopération avec l’Agence nationale de la sécurité des systèmes d’information (ANSSI) ou avec un cyber campus régional]")
```

+ **Le déploiement d’outils techniques de sécurisation des réseaux informatiques**

```{r}
stat_qs_simple(196, "Parmi les mesures suivantes, qui visent à réduire le risque de cybersécurité, est-ce que votre structure a mis en place : [Le déploiement d’outils techniques de sécurisation des réseaux informatiques]")
```



## Le numérique responsable


### Votre structure a-t-elle engagé une réflexion sur les enjeux du numérique responsable ?

```{r}
stat_qs_simple(197, "Votre structure a-t-elle engagé une réflexion sur les enjeux du numérique responsable ?")
```


### Cette stratégie aborde-t-elle les thématiques suivantes ?

```{r}
stat_qs_multiple(198, 203, "Cette stratégie aborde-t-elle les thématiques suivantes ?")
```


### Concernant les thématiques de l’inclusion et de l’accessibilité numérique, votre structure a-t-elle engagé une réflexion sur les sujets suivants

```{r}
stat_qs_multiple(205, 213, "Concernant les thématiques de l’inclusion et de l’accessibilité numérique, votre structure a-t-elle engagé une réflexion sur les sujets suivants")
```



```{r eval=FALSE, include=FALSE}
library(glue)

# Stats centralisées dans tableau
    # Fonctions qs simples
table_recap_simple <- function(n_col){
    name <- names(data_clean_unique[,n_col])
    nb_communes <- (data_clean_unique |> 
        select(n_col, 225) |> 
        na.omit() |> 
        summarise(n_total = n(), .by = Catégorie) |> 
        filter(Catégorie == "Une commune"))$n_total
    ref_question <- data_clean_unique |> 
        select(n_col, 226) |> 
        na.omit() |> 
        summarise(n_total = n(), .by = Catégorie2)
    total <- sum(ref_question$n_total)
    ref_question <- ref_question |> 
        add_row(Catégorie2 = "Total", n_total = total) |> 
        add_row(Catégorie2 = "Une commune", n_total = nb_communes)

    cat1 <- data_clean_unique |> 
        select(n_col, Catégorie2) |> 
        summarise(n = n(), .by = c(Catégorie2, 1)) |>  
        pivot_wider(names_from = 2, values_from = 3) |>
        janitor::adorn_totals("row") |>
        pivot_longer(cols = -Catégorie2, names_to = "cat", values_to = "n") |> 
        mutate_all(replace_na, replace = 0) |>
        left_join(ref_nb_structures, by = "Catégorie2") |> 
        mutate(percent = round(n / n_total *100, 0), .by = Catégorie2)
    cat2 <- data_clean_unique |> 
        select(n_col, Catégorie) |> 
        filter(Catégorie == "Une commune") |> 
        summarise(n = n(), .by = c(Catégorie, 1)) |>  
        #mutate_all(replace_na, replace = 0) |>
        mutate(n_total = nb_communes,
               percent = round(n / 30 *100, 0), .by = Catégorie)
    lignes <- nrow(cat2)
    cat2[lignes+1, 1] <- "Une commune"
    cat2[lignes+1, 2] <- NA_character_
    cat2[lignes+1, 3] <- 0
    cat2[lignes+1, 4] <- 30
    cat2[lignes+1, 5] <- 0
    cat2 <- cat2 |> 
        filter(row_number() == 1, .by = 2)
     # Moyenne pondérée
    moy_pond <- data_clean_unique |> 
        select(n_col, Catégorie2) |> 
        summarise(n = n(), .by = c(Catégorie2, 1)) |> 
        pivot_wider(names_from = 2, values_from = 3) |>
        pivot_longer(cols = -Catégorie2, names_to = "cat", values_to = "n") |> 
        mutate_all(replace_na, replace = 0) |>
        left_join(prop_all |> select(1, 6), by = c("Catégorie2" = "Structure")) |> 
        mutate(poids = case_when(is.na(poids) ~ 0, .default = poids),
               .by = Catégorie2) |> 
        mutate(poids_CT = n * poids) |> 
        group_by(cat) |> 
        summarise(p=sum(poids_CT)) |> ungroup() |> 
        mutate(percent= round(p/sum(p)*100, 0)) |> 
        select(-p) |> 
        mutate(Question = name, .before = 1) |> 
        mutate(Catégorie = "Total pondéré", .after = 1) |> 
        mutate(n = NA_real_, n_total = NA_real_)
    # All
    all_stat <- rbind(cat1 |> rename(Catégorie = Catégorie2), cat2 |> rename(cat = 2)) |> 
        mutate(Question = name, .before = 1) |> 
        rbind(moy_pond) |> 
        left_join(ref_question |> rename(`Nombre de réponses` = n_total), by = c("Catégorie" = "Catégorie2")) |> 
        rename(Structure = Catégorie, Réponses = cat, Occurrences = n, Pourcentage = percent, `Effectifs par structure` = n_total) |> 
        mutate(index = case_match(Structure, 
                                  "Total" ~ 1.5,
                                  "Une commune" ~ 2,
                                  "Communes de moins de 3 500 hab." ~ 3,
                                  "Communes de 3 500 à 10 000 hab." ~ 4,
                                  "Communes de 10 000 à 100 000 hab." ~ 5,
                                  "Communes de plus de 100 000 hab." ~ 6,
                                  "Une métropole" ~ 7,
                                  "Un EPCI (hors métropole)" ~ 8,
                                  "Un département" ~ 9,
                                  "Une région" ~ 10,
                                  "Autre" ~ 11, 
                                  .default = 1)) |> 
        arrange(index) |> select(-index) |> 
        select(1:4, 7, 5, 6) |> 
        mutate(Occurrences = as.integer(Occurrences),
               Réponses = str_replace_all(Réponses, 'NA', "Sans réponse"))

    assign(glue("all_stat_{n_col}"), all_stat, envir = .GlobalEnv)
}
    # Fonctions qs mutliples
table_recap_multiple <- function(min_col, max_col){
    name <- names(data_clean_unique[,min_col]) |> str_extract("^.*\\[") |> str_replace_all("\\[", "")
    nb_communes <- (data_clean_unique |> 
        select(min_col:max_col, 225) |> 
        group_by(Catégorie) |> 
        filter(across(where(is.character), ~. != "N/A")) |> 
        ungroup() |> 
        summarise(n_total = n(), .by = Catégorie) |> 
        filter(Catégorie == "Une commune"))$n_total
    ref_question <- data_clean_unique |> 
        select(min_col:max_col, 226) |> 
        group_by(Catégorie2) |> 
        filter(across(where(is.character), ~. != "N/A")) |> 
        ungroup() |> 
        summarise(n_total = n(), .by = Catégorie2)
    total <- sum(ref_question$n_total)
    ref_question <- ref_question |> 
        add_row(Catégorie2 = "Total", n_total = total) |> 
        add_row(Catégorie2 = "Une commune", n_total = nb_communes)
    sans_rep <- data_clean_unique |> 
        select(min_col:max_col, 226) |> 
        group_by(Catégorie2) |> 
        summarise_all(funs(sum(. == "N/A"))) |> 
        janitor::adorn_totals("row") |>
        select(Catégorie2, 2) |> 
        rename(`Sans réponse` = 2) |> 
        mutate(n2 = case_when(grepl("Communes", Catégorie2) == TRUE ~ `Sans réponse`, .default = NA_real_))
    sans_rep <- sans_rep |> 
        add_row(Catégorie2 = "Une commune", `Sans réponse` = sum(sans_rep$n2, na.rm = TRUE)) |> 
        select(-n2)
    cat1 <- data_clean_unique |> 
        select(min_col:max_col, 226) |> 
        group_by(Catégorie2) |> 
        summarise_all(funs(sum(. == "Oui"))) |> 
        left_join(sans_rep, by = "Catégorie2") |> 
        janitor::adorn_totals("row") |>
        pivot_longer(cols = -Catégorie2, names_to = "cat", values_to = "n") |> 
        left_join(ref_nb_structures, by = "Catégorie2") |> 
        mutate(percent = round(n / n_total *100, 0), .by = Catégorie2) |> 
        mutate(cat = str_extract(cat, "(?<=\\[).*"),
               cat = str_replace_all(cat, "\\]", ""))
        
    cat2 <- data_clean_unique |> 
        filter(Catégorie == "Une commune") |> 
        select(min_col:max_col, 225) |> 
        group_by(Catégorie) |> 
        summarise_all(funs(sum(. == "Oui"))) |> 
        left_join(sans_rep, by = c("Catégorie" = "Catégorie2")) |> 
        pivot_longer(cols = -Catégorie, names_to = "cat", values_to = "n") |> 
        mutate(cat = str_extract(cat, "(?<=\\[).*"),
               cat = str_replace_all(cat, "\\]", ""),
               #cat = replace_na(cat, "NA"),
               percent = round(n / 30 *100, 0),
               n_total = 30) 
     # Moyenne pondérée
    moy_pond <- data_clean_unique |> 
        select(min_col:max_col, 226) |> 
        group_by(Catégorie2) |> 
        summarise_all(funs(sum(. == "Oui"))) |> 
        pivot_longer(cols = -Catégorie2, names_to = "cat", values_to = "n") |> 
        mutate(cat = str_extract(cat, "(?<=\\[).*"),
               cat = str_replace_all(cat, "\\]", "")) |> 
        mutate_all(replace_na, replace = 0) |>
        left_join(prop_all |> select(1, 6), by = c("Catégorie2" = "Structure")) |> 
        mutate(poids = case_when(is.na(poids) ~ 0, .default = poids),
               .by = Catégorie2) |> 
        mutate(poids_CT = n * poids) |> 
        group_by(cat) |> 
        summarise(p=sum(poids_CT)) |> ungroup() |> 
        mutate(percent= round(p/sum(p)*100, 0)) |> 
        select(-p) |> 
        mutate(Catégorie = "Total pondéré", .after = 1) |> 
        mutate(n = NA_real_, n_total = NA_real_)
    
    all_stat <- list(cat2, cat1 |> rename(Catégorie = Catégorie2)) |> 
        bind_rows() |> ungroup() |> 
        rbind(moy_pond) |> 
        mutate(Question = name, .before = 1) |> 
        mutate(cat = replace_na(cat, "Sans réponse"),
               index = case_match(Catégorie, 
                                  "Une commune" ~ 2,
                                  "Communes de moins de 3 500 hab." ~ 3,
                                  "Communes de 3 500 à 10 000 hab." ~ 4,
                                  "Communes de 10 000 à 100 000 hab." ~ 5,
                                  "Communes de plus de 100 000 hab." ~ 6,
                                  "Une métropole" ~ 7,
                                  "Un EPCI (hors métropole)" ~ 8,
                                  "Un département" ~ 9,
                                  "Une région" ~ 10,
                                  "Autre" ~ 11, 
                                  .default = 1)) |> 
        arrange(index) |> select(-index) |> ungroup() |> 
        left_join(ref_question |> rename(`Nombre de réponses` = n_total), by = c("Catégorie" = "Catégorie2")) |> 
        rename(Structure = Catégorie, Réponses = cat, Occurrences = n, Pourcentage = percent, `Effectifs par structure` = n_total) |> 
        select(1:4, 7, 6, 5)

    assign(glue("all_stat_multiples_{min_col}"), all_stat, envir = .GlobalEnv)
}


# Application des fonctions créées
    # Qs simples
library(purrr)
purrr::map(.x = c(13:16, 18, 26:38, 40:44, 46, 49, 55, 66:68, 70, 84:90, 93:96, 99:108, 111:113, 115, 139, 162:178, 180, 181, 188:197),
          .f = ~table_recap_simple(.x))
table_qs_simples <- rbind(lapply(ls(pattern="^all_stat_"), function(x) get(x))) |> 
    bind_rows() |> 
    mutate(Réponses = replace_na(Réponses, "Sans réponse"))
    # Qs multiples
table_recap_multiple(19,22)
table_recap_multiple(50,53)
table_recap_multiple(58,63)
table_recap_multiple(71,75)
table_recap_multiple(77,82)
table_recap_multiple(116,121)
table_recap_multiple(123,136)
table_recap_multiple(140,145)
table_recap_multiple(147,160)
table_recap_multiple(182,186)
table_recap_multiple(198,203)
table_recap_multiple(205,213)
table_qs_multiple <- rbind(lapply(ls(pattern="^all_stat_multiples_"), function(x) get(x))) |>
    bind_rows() |> 
    mutate(Réponses = replace_na(Réponses, "Sans réponse"))
    # Tout ensemble
table_recap_stat <- rbind(table_qs_simples, table_qs_multiple)
    # Ajout Total hors communes de moins de 3500 hab
tot_plus3500 <- table_recap_stat |> 
  filter(Structure == "Total" | Structure == "Communes de moins de 3 500 hab.") |> 
  pivot_wider(names_from = Structure, values_from = c(Occurrences, `Nombre de réponses`)) |> 
  mutate(Occurrences = sum(Occurrences_Total, -`Occurrences_Communes de moins de 3 500 hab.`, na.rm = T), 
         `Nombre de réponses` = sum(`Nombre de réponses_Total`, -`Nombre de réponses_Communes de moins de 3 500 hab.`, na.rm = T), 
         .by = c(Question, Réponses)) |> 
  distinct(Question, Réponses, Occurrences, `Nombre de réponses`) |> 
  mutate(`Effectifs par structure` = 191-9,
         `Structure` = "Total hors communes < 3500 habitants",
         Pourcentage = round(Occurrences/182 *100, 0))
table_recap_stat <- rbind(table_recap_stat, tot_plus3500) |> 
  arrange(Question, Structure)
    # Export
table_recap_stat |> rio::export("../Data/All_statistics.csv")
```

